<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.tm.cgv.couponInfo.CouponInfoRepository">

	<select id="couponInfoSelectOne" parameterType="CouponInfoVO" resultType="CouponInfoVO">
		select * from couponInfo where serialNum = #{serialNum} and pwd=#{pwd} and sysdate() <![CDATA[<]]> eIssuance
	</select>
	
	<select id="couponInfoSelect" parameterType="CouponInfoVO" resultType="CouponInfoVO">
		select * from couponInfo where num=#{num} 
	</select>
	
	
	<select id="couponInfoList" parameterType="Pager" resultType = "CouponInfoVO">
		select * from couponInfo
		where name like concat('%',#{search},'%')
		<if test="kind != ''">
			and type=#{kind}
		</if>
		<if test="startDate != ''">
			and #{startDate} <![CDATA[<=]]>  sIssuance
		</if>
		<if test="endDate != ''">
			and #{endDate} <![CDATA[>=]]>  eIssuance
		</if>
		order by num desc
		limit #{startRow},10
	</select>
		
	<select id="couponInfoListCount" parameterType="Pager" resultType="Long">
		select count(num) from couponInfo
		where name like concat('%',#{search},'%')
		<if test="kind != ''">
			and type=#{kind}
		</if>
		<if test="startDate != ''">
			and #{startDate} <![CDATA[<=]]>  sIssuance
		</if>
		<if test="endDate != ''">
			and #{endDate} <![CDATA[>=]]>  eIssuance
		</if>
	</select>
	
	<delete id="couponInfoDelete" parameterType="CouponInfoVO">
		delete from couponInfo where num=#{num}
	</delete>
	
	<insert id="couponInfoInsert" parameterType="CouponInfoVO">
		insert into couponInfo values(0,#{name},#{serialNum},#{pwd,jdbcType=VARCHAR},#{price},#{type},#{count,jdbcType=INTEGER},
		#{sIssuance},#{eIssuance})
	</insert>
	
	<update id="couponInfoUpdate" parameterType="CouponInfoVO">
		update couponInfo set name=#{name},serialNum=#{serialNum},pwd=#{pwd,jdbcType=VARCHAR},price=#{price},count = #{count,jdbcType=INTEGER},
		sIssuance=#{sIssuance},eIssuance=#{eIssuance} where num=#{num}
	</update>
	
	<update id="couponCount" parameterType="Integer">
		update couponInfo set count = count-1 where num = #{num}
	</update>
	

</mapper>