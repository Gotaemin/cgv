<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.tm.cgv.event.EventRepository">
	<resultMap type="EventVO" id="selectList">
		<id column="num" property="num"></id>
		<result column="category" property="category"/>
		<result column="title" property="title"/>
		<result column="startDate" property="startDate"/>
		<result column="endDate" property="endDate"/>
		<result column="contents" property="contents"/>
	
		<collection property="eventImageVOs" javaType="List" ofType="EventImageVO">
			<id column="imageNum" property="num"></id>
			<result column="fileName" property="fileName"/>
			<result column="originName" property="originName"/>
			<result column="type" property="type"/> 
		</collection>
		
	</resultMap>


	<select id="eventList" resultType="EventVO">
		select * from event
	</select>
	
	<insert id="eventInsert" parameterType="EventVO" useGeneratedKeys="true" keyProperty="num">
		insert into event (num, category, title, startDate, endDate, contents) 
		values (#{num}, #{category}, #{title}, #{startDate}, #{endDate}, #{contents})
	</insert>
	
	<select id="eventSelect" parameterType="Integer" resultMap="selectList">
		select E.*, I.* from
		(select * from event) as E
		left join
		(select num as imageNum, eventNum, fileName, originName, type from eventImage) as I
		on (E.num = I.eventNum)
		where E.num=#{num}

	</select>
	
	<update id="eventUpdate" parameterType="EventVO">
		update event set category=#{category}, title=#{title}, 
		startDate=#{startDate}, endDate=#{endDate}, contents=#{contents}
		where num=#{num}
	</update>
	
</mapper>