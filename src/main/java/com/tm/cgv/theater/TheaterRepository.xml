<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.tm.cgv.theater.TheaterRepository">
	<resultMap type="MovieTimeVO" id="selectTheater">
		<id column="num" property="num"></id>
		<result column="movieNum" property="movieNum"/>
		<result column="theaterNum" property="theaterNum"/>
		<result column="screenDate" property="screenDate"/>
		<result column="screenTime" property="screenTime"/>
		<result column="remainSeat" property="remainSeat"/>
		<result column="selectedFilm" property="selectedFilm"/>
		
		<association property="movieInfoVOs" javaType="MovieInfoVO">
			<id column="num" property="num"/>
			<result column="title" property="title"/>
			<result column="runtime" property="runtime"/>
		</association>
	</resultMap>
	
	<select id="theaterList" resultType="TheaterVO">
		select * from theater
	</select>
	
	<insert id="theaterInsert" parameterType="TheaterVO" useGeneratedKeys="true" keyProperty="num">
		insert into theater(cinemaNum,name,seatCount,filmType) values(#{cinemaNum},#{name},#{seatCount},#{filmType})
	</insert>
	
	<select id="theaterNameCheck" parameterType="TheaterVO" resultType="TheaterVO">
		select * from theater where name=#{name} and cinemaNum=#{cinemaNum}
	</select>
	
	<select id="cinemaList" resultType="CinemaVO">
		select num,name from cinema
	</select>
	
	<select id="selectRow" parameterType="Integer" resultType="String">
		select max(rowIdx) from seat where theaterNum=#{num};
	</select>
	
	<select id="selectCol" parameterType="Integer" resultType="Integer">
		select max(colIdx) from seat where theaterNum=#{num}
	</select>
	
	
	<select id="theaterSelect" parameterType="Integer" resultType="TheaterVO">
		select * from theater where num=#{num}
	</select>
	
	<select id="theaterSeat" parameterType="Integer" resultType="SeatVO">
		 select * from seat where theaterNum=#{num}
	</select>
	
	<select id="theaterSpace" parameterType="Integer" resultType="SeatSpaceVO">
		 select * from seatSpace where theaterNum=#{num}
	</select>
	
	
	
	
	
	<update id="theaterUpdate" parameterType="TheaterVO">
		update theater set name=#{name}, seatCount=#{seatCount}, filmType=#{filmType} where num=#{num}
	</update>
	
	<delete id="theaterDelete" parameterType="Integer">
		delete from theater where num=#{num}
	</delete>
	
	<select id="theaterNum" resultType="Integer">
		select max(num) from theater
	</select>
	
	
	
	<select id="theaterMovieTime" parameterType="Map" resultMap="selectTheater">
		select M.*, F.title, F.runtime from movieTime M 
		left join movieInfo F
		on M.movieNum=F.num
		where theaterNum=#{theaterNum} and M.screenDate 
		between date(#{startDay}) and date(#{lastDay})
	</select>

	

</mapper>